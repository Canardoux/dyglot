#!/bin/bash
set -e

APP_ID="xyz.canardoux.dyglot"
ANDROID_DIR="$(cd "$(dirname "$0")" && pwd)/../android"

echo "ANDROID_DIR=$ANDROID_DIR"
cd "$ANDROID_DIR"

# üî¢ Incr√©ment automatique versionCode
VERSION_CODE=$(grep versionCode app/build.gradle | awk '{print $2}')
NEW_VERSION_CODE=$((VERSION_CODE + 1))

echo "‚û°Ô∏è  versionCode $VERSION_CODE ‚Üí $NEW_VERSION_CODE"

sed -i '' "s/versionCode $VERSION_CODE/versionCode $NEW_VERSION_CODE/" app/build.gradle

# üèó Build APK debug
./gradlew assembleDebug

# üì≤ Install sur le t√©l√©phone
APK_PATH="app/build/outputs/apk/debug/app-debug.apk"

adb install -r "$APK_PATH"

echo "‚úÖ Dyglot install√© (versionCode=$NEW_VERSION_CODE)"
